<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>订单详情页面</title>
<link href="../css/bootstrap.min.css" rel="stylesheet">
<link type="text/css" rel="stylesheet" href="./css/mystyle.css"/>
<style type="text/css">
		.container{
			text-align:center;
		}
	     .small-button {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: none;
                margin-left:10px;
                margin-right:10px;
            }
              .center {
                text-align: center;
            }
             #totalCount, #totalPrice {
                font-size:25px;
                color: red;
            }
            #totalPrice {
                display: inline-block;
                width: 150px;
                text-align:left;
            }
            #cart-footer{
            	margin-bottom:30px;
            }
</style>
</head>
<body>
<header>
    <div class="soubg">
        <div class="sou fl">
            <div class="s_city_b">
                <span>送货至：湖北武汉</span>
            </div>
        </div>
        <div class="fr top_right">
            <div class="fl">
                <span id="span_l">你好! 请<a href="login.html">登录</a></span>
                <a href="register.html" style="color:#ff4e00;" id="show_11">免费注册</a>
                <b onclick="cancellogin()" style="color:#ff4e00;display:none;cursor:pointer" id="show_12">退出登录</b>
                &nbsp;|&nbsp;<a href="#">我的订单</a>&nbsp;|
            </div>
            <ul class="ss">
                <li class="ss_list">
                    <a href="#">收藏夹</a>
                </li>
                <!--需要有向下的小箭头就添加ss_listBg-->
                <li class="ss_list ss_listBg">
                    <a href="#">客户服务</a>

                    <div class="ss_list_bg">
                        <div class="ss_list_c">
                            <ul>
                                <li><a href="#">包裹跟踪</a></li>
                                <li><a href="#">常见问题</a></li>
                                <li><a href="#">在线退款</a></li>
                                <li><a href="#">在线投诉</a></li>
                                <li><a href="#">配送范围</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li class="ss_list">
                    <a href="#">网站导航</a>
                </li>
            </ul>
            <span class="fl">&nbsp;|&nbsp;关注我们：</span>
                <span class="s_sh">
                    <a href="#" class="sh1">新浪</a>
                    <a href="#" class="sh2">微信</a>
                </span>
                <span class="fr">|&nbsp;
                    <a href="#">手机版&nbsp;
                        <img src="images/s_tel.png" align="absmiddle"/>
                    </a>
                </span>
        </div>
    </div>

    <div class="top">
        <div class="logo">
            <a  href="Index.html">
                <img src="../images/mainlogo.jpeg" style="width:200px;height:72px;"/>
            </a>
        </div>
        <div class="search">
            <form>
                <input type="search" value="" placeholder="请输入关键字" class="s_ipt"/>
                <input type="submit" value="搜索" class="s_btn"/>
            </form>
            <div class="fl">
                <a href="#">咖啡</a>
                <a href="#">iphone 6S</a>
                <a href="#">新鲜美食</a>
                <a href="#">蛋糕</a>
                <a href="#">日用品</a>
                <a href="#">连衣裙</a>
            </div>
        </div>
        <div class="i_car">
            <div class="car_t">购物车</div>
        </div>
    </div>
</header>


<div class="container">
		<h1>订单详情页面</h1>
		<nav class="navbar navbar-default">
			<div class="container-fluid">
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse"
					id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav" id="category">
					</ul>
					<ul class="nav navbar-nav navbar-left"
						style="margin-left: 10px; line-height: 50px">
						<li><a class="glyphicon glyphicon-arrow-left" href="javascript:history.back()"> 返回</a></li>
					</ul>
					
				</div>
				<!-- /.navbar-collapse -->
			</div>
			<!-- /.container-fluid -->
		</nav>
		<div class="row" id="contentPanel">
			<div class="col-md-12">
				<table class="table table-bordered" id="content">
					
				</table>
			</div>
		</div>
		<h3 style="text-align:left">填写收货人地址信息:</h3>
		<div style="text-align:left;width:300px">
			<div class="form-group">
				<label for="name">用户名</label> <input type="text"
					class="form-control" id="name" placeholder="用户名">
			</div>
			<div class="form-group">
				<label for="password">电话</label> <input type="tel"
					class="form-control" id="tel" placeholder="电话">
			</div>
			<div class="form-group">
				<label for="password">收货地址</label> <input type="text"
					class="form-control" id="address" placeholder="收货地址">
			</div>
		</div>
		<div id="cart-footer">
	         <div class="text-right" style="font-size:15px">
	                <span>总共选中了<span id="totalCount">0</span>件商品</span>
	                <span>总计: <span id="totalPrice">¥0.00</span></span>
	                <button class="btn btn-danger btn-lg" id="submitOrder">下单支付</button>
	          </div>
         </div>
	</div>
	
	
<!--网页底部-->
<footer class="center">
    <!-- Footer -->
    <div class="b_btm_bg b_btm_c">
        <ul class="b_btm">
            <li>
                <a><img src="images/b1.png" width="62" height="62"/></a>
                <div><h2>正品保障</h2>正品行货 放心购买</div>
            </li>
            <li >
                <a><img src="images/b2.png" width="62" height="62"/></a>
                <div><h2>满38包邮</h2>满38包邮 免运费</div>
            </li>
            <li>
                <a><img src="images/b3.png" width="62" height="62"/></a>
                <div><h2>天天低价</h2>天天低价 畅选无忧</div>
            </li>
            <li>
                <a><img src="images/b4.png" width="62" height="62"/></a>
                <div><h2>准时送达</h2>收货时间由你做主</div>
            </li>
        </ul>
    </div>
    <div class="b_nav">
        <dl>
            <dt><a href="#">新手上路</a></dt>
            <dd><a href="#">售后流程</a></dd>
            <dd><a href="#">购物流程</a></dd>
            <dd><a href="#">订购方式</a></dd>
            <dd><a href="#">隐私声明</a></dd>
            <dd><a href="#">推荐分享说明</a></dd>
        </dl>
        <dl>
            <dt><a href="#">配送与支付</a></dt>
            <dd><a href="#">货到付款区域</a></dd>
            <dd><a href="#">配送支付查询</a></dd>
            <dd><a href="#">支付方式说明</a></dd>
        </dl>
        <dl>
            <dt><a href="#">会员中心</a></dt>
            <dd><a href="#">资金管理</a></dd>
            <dd><a href="#">我的收藏</a></dd>
            <dd><a href="#">我的订单</a></dd>
        </dl>
        <dl>
            <dt><a href="#">服务保证</a></dt>
            <dd><a href="#">退换货原则</a></dd>
            <dd><a href="#">售后服务保证</a></dd>
            <dd><a href="#">产品质量保证</a></dd>
        </dl>
        <dl>
            <dt><a href="#">联系我们</a></dt>
            <dd><a href="#">网站故障报告</a></dd>
            <dd><a href="#">购物咨询</a></dd>
            <dd><a href="#">投诉与建议</a></dd>
        </dl>
        <div class="b_tel_bg">
            <a href="#" class="b_sh1">新浪微博</a>
            <a href="#" class="b_sh2">腾讯微博</a>

            <p>
                服务热线：<br/>
                <span>400-123-4567</span>
            </p>
        </div>
        <div class="b_er">
            <div class="b_er_c"><img src="images/er.gif" /></div>
            <img src="images/ss.png"/>
        </div>
    </div>
    <div class="btmbg">
        <div class="btm">
            备案/许可证编号：蜀ICP备12009302号-1-www.dingguagua.com Copyright© 1号店网上超市 2007-2016，All Rights Reserved. 复制必究 ,
            Technical Support: Dgg Group <br/>
            <img src="images/b_1.gif"/>
            <img src="images/b_2.gif"/>
            <img src="images/b_3.gif"/>
            <img src="images/b_4.gif"/>
            <img src="images/b_5.gif"/>
            <img src="images/b_6.gif"/>
        </div>
    </div>
    <!--Footer -->
</footer>
	
	
	
	<script type="text/javascript" src="../js/jquery-2.2.4.js"></script>
    <script type="text/javascript" src="../js/layer.js"></script>
    <script type="text/javascript" src="../js/mylayer.js"></script>
    <script type="text/javascript" src="../js/cookie.js"></script>
    <script type="text/javascript">
        //加载订单数据
        function showLoginPanel(){
	if(cookie.get("username")!=null&&cookie.get("username")!=""){
		$("#span_l").html("欢迎您: "+cookie.get("username"));
		$("#show_11").hide();
		$("#show_12").show();
	}else{
		$("#span_l").html("你好! 请");
		var a = $("<a href='login.html'>登录</a>")
		$("#span_l").append(a);
		$("#show_11").show();
		$("#show_12").hide();
	}
}
function cancellogin(){
	cookie.set("username","");
	showLoginPanel();
	mylayer.tips("退出成功");
}
        
        $(function(){
        	showLoginPanel();
        	var selectCartListStr = localStorage.getItem("selectCartList");
			if(selectCartListStr!=null&&selectCartListStr!="{}"){
				selectCartList = JSON.parse(selectCartListStr);
				console.log(JSON.parse(selectCartListStr));
				//填充购物车的数据到界面上
				var content = $("#content");
				content.empty();
				var thead = $("<tr>\
							<th>商品id</th>\
							<th>图片</th>\
							<th>商品名称</th>\
							<th>价格</th>\
							<th>数量</th>\
							<th>小计</th>\
						</tr>");
				content.append(thead);
				var totalCount = 0;
				var totalPrice = 0;
				for(var key in selectCartList){
					var product = selectCartList[key];
					var tr = $("<tr>");
	
					var pro_id_td = $("<td>"+product.pro_id+"</td>"); 
					tr.append(pro_id_td);
					
					var pro_image_td = $("<td><img style='width:50px' src='../images/"+product.pro_image+"'/></td>");
					tr.append(pro_image_td);
					
					var pro_id_name = $("<td>"+product.pro_name+"</td>"); 
					tr.append(pro_id_name);
					
			
					var pro_id_price = $("<td><span>¥:</span><span class='price'>"+product.pro_price.toFixed(2)+"</span></td>"); 
					tr.append(pro_id_price);
				
					var number_td = $("<td>");
					var pro_num_td = $("<p>"+product.pro_num+"</p>");
					totalCount += product.pro_num;
					number_td.append(pro_num_td);
					tr.append(number_td);
					//小计
					var subTotal_td = $("<td style='width:120px;'>¥:"+(product.pro_num*product.pro_price).toFixed(2)+"</td>");
					tr.append(subTotal_td);
					
					totalPrice += product.pro_num * product.pro_price;
					
					content.append(tr);	
				}
				//显示多少件商品和  总价
		        $('#totalCount').text(totalCount);
	            $('#totalPrice').html('¥' + totalPrice.toFixed(2));
			}else{
			    console.log("购物车是空的");	
			}
			//绑定下单 的事件
			$("#submitOrder").click(function(){
				if($("#name").val()==''){
					mylayer.showError("请填写用户名");
					return;
				}
				if($("#tel").val()==''){
					mylayer.showError("请填写电话");
					return;
				}
				if($("#address").val()==''){
					mylayer.showError("请填写地址信息");
					return;
				}
				//实现loading
				mylayer.showLoading("拼命加载中");
				$.ajax({
					type:"POST",
					url:"../submitOrder",
					contentType: "application/json; charset=utf-8",
					dataType:"json",
					data:JSON.stringify({
						//生成订单号的
						u_id:cookie.get("userid"),
						o_address:$("#address").val(),
				        o_name:$("#name").val(),
				        o_tel:$("#tel").val(),
				        o_total:totalPrice,
				        //购物车的数据  是用来生成订单项的  
				        selectCartList:selectCartList
					}),
					success:function(data){
						mylayer.closeLoading();
						console.log(data);
						if(data.retcode==="0"){
							mylayer.showCallBackMessage("订单提交成功，跳转支付页面",function(){
								//要在跳页面之前写好逻辑   跳转之后就失效了
								var cartListStr = localStorage.getItem("cartList");
								var cartList = JSON.parse(cartListStr);
								for(var key in cartList){
									if(selectCartList[key]!=undefined){
										delete cartList[key];
									}
								}
								localStorage.setItem("cartList",JSON.stringify(cartList));
								//跳转到支付页面进行付款的
								window.location.href = "pay.html?o_id="+data.data;
								//清空对应的购物车选项
								//selectCartList
							});
						}else{
							mylayer.showError(data.data);
						}
					},
					error:function(xhr,error,status){
						mylayer.closeLoading();
						mylayer.showError(error);
					}
				})
			});
        });
        
        // 判断用户是否登录
        if(cookie.get("username")!=null&&cookie.get("username")!=""){
			   console.log("用户已经登录了 可以支付");
	    }else{
			var callback = window.location.href;
		    window.location.href = "login.html?callback="+callback;
		};	
    </script>
</body>
</html>