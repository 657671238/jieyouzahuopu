<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ela Admin - HTML5 Admin Template</title>
    <meta name="description" content="Ela Admin - HTML5 Admin Template">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <link rel="stylesheet" href="assets/css/normalize.css">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/css/themify-icons.css">
	<link rel="stylesheet" href="assets/css/pe-icon-7-filled.css">
    <link rel="stylesheet" href="assets/css/flag-icon.min.css">
    <link rel="stylesheet" href="assets/css/cs-skin-elastic.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->

	<link href="assets/css/charts/chartist.min.css" rel="stylesheet">
	<link href="assets/css/lib/vector-map/jqvmap.min.css" rel="stylesheet">
	
	
	<link rel="stylesheet" href="../layui/css/layui.css"  media="all">
	<link rel="stylesheet" href="../css/fenye_page.css"  rel="stylesheet">
   <style>
   	#content-table{
		width:90%;
		margin:0px auto;
	}
	#content a{
		text-decoration:none;
	}
	#content th{
		font-size:16px;
	}
	#footer-nav{
		text-align:center;
	}
	.mycate{
		width:90%;
		margin:0px auto;
	}
	.mynav{
		width:90%;
		margin:0 auto;
	}
	.fontred{
		color:red;
	}
	.fontgreen{
		color:green;
	}
	.mycate{
		width:90%;
		margin:0px auto;
	}
    </style>
</head>

<body>
    <!-- Left Panel -->
    <aside id="left-panel" class="left-panel">
        <nav class="navbar navbar-expand-sm navbar-default">
            <div id="main-menu" class="main-menu collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="menu-title">UI elements</li><!-- /.menu-title -->
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-cogs"></i>商品管理</a>
                        	<ul class="sub-menu children dropdown-menu">                            
	                        	<li><i class="fa fa-puzzle-piece"></i><a href="index.html">商品列表</a></li>
	                            <li><i class="fa fa-id-badge"></i><a href="addProduct.html">商品添加</a></li>
                        	</ul>
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-table"></i>轮播管理</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="fa fa-table"></i><a href="lunbolist.html">轮播列表</a></li>
                            <li><i class="fa fa-table"></i><a href="addLunBo.html">添加轮播</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="remen.html"> <i class="menu-icon ti-email"></i>热门管理 </a>
                    </li>
                    <li>
                        <a href="edituser.html"> <i class="menu-icon fa fa-line-chart"></i>用户管理 </a>
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-tasks"></i>订单管理</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-fort-awesome"></i><a href="orders.html">订单列表</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>
    </aside>
    <!-- /#left-panel -->
    <!-- Right Panel -->
    <div id="right-panel" class="right-panel" style="height:100%">
        <!-- Header-->
        <header id="header" class="header">
            <div class="top-left">
                <div class="navbar-header">
                    <a class="navbar-brand" href="./"><img src="images/logo.png" alt="Logo"></a>
                    <a class="navbar-brand hidden" href="./"><img src="images/logo2.png" alt="Logo"></a>
                </div>
            </div>
            <div class="top-right">
                <div class="header-menu">

                    <div class="user-area dropdown float-right">
                        <a href="#" class="dropdown-toggle active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="user-avatar rounded-circle" src="images/admin.jpg" alt="User Avatar">
                        </a>

                        <div class="user-menu dropdown-menu">
                            <a class="nav-link" href="#"><i class="fa fa- user"></i>My Profile</a>

                            <a class="nav-link" href="#"><i class="fa fa- user"></i>Notifications <span class="count">13</span></a>

                            <a class="nav-link" href="#"><i class="fa fa -cog"></i>Settings</a>

                            <a class="nav-link" href="#"><i class="fa fa-power -off"></i>Logout</a>
                        </div>
                    </div>

                </div>
            </div>
        </header>
        <!-- /#header -->
        <!-- Content -->
        <div class="pagecontent" style="min-height:564px;background-color:white;">
            <!-- 主体内容 -->
            <div class=".mynav" style="padding-left:50px;margin-bottom:20px;">
            	<h2>轮播列表</h2>
            </div>
           <div id="content-table">
	         	<table class="table" id="content">
										
				</table>
	           
	           <div id="footer-nav" class="zxf_pagediv"></div>
           </div>
           
        </div>
        <!-- /.content -->
        <div class="clearfix"></div>
    </div>
    
    <!-- /#right-panel -->

<script src="../js/jquery-2.2.4.min.js"></script>
<script src="assets/js/popper.min.js"></script>
<script src="assets/js/plugins.js"></script>
<script src="assets/js/main.js"></script>

<script src="assets/js/lib/chartist/chartist.min.js"></script>
<script src="assets/js/lib/chartist/chartist-plugin-legend.js"></script>
<script src="assets/js/lib/flot-chart/jquery.flot.js"></script>
<script src="assets/js/lib/flot-chart/jquery.flot.pie.js"></script>
<script src="assets/js/lib/flot-chart/jquery.flot.spline.js"></script>
<script src="assets/weather/js/jquery.simpleWeather.min.js"></script>
<script src="assets/weather/js/weather-init.js"></script>


<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.js"></script>
<script src="assets/js/init/fullcalendar-init.js"></script>

<script src="../js/jquery-2.2.4.min.js"></script>

<script src="../js/layer.js" charset="utf-8"></script>
<script src="../js/mylayer.js" charset="utf-8"></script>
<script src="../js/fenye_page.js" charset="utf-8"></script>

<script>
var start = 0; //开始位置
var length = 10;//每次请求的数据条数
var total = 0;  //总的数据长度

var pageCount =Math.ceil(total/length);//页面总数



jQuery(function($) {
	request_total();
	loadData(1);
});



//获取总的条目数
function request_total(){
	$.ajax({
		type:"GET",
		url:"../totalLunBo",
		dataType:"json",
		success:function(data){
			console.log(data);
			if(data.retcode==="0"){
				total = data.data;
				pageCount =Math.ceil(total/length);
				console.log(pageCount);
				$(".zxf_pagediv").createPage({
					pageNum: pageCount,
					current: 1,
					backfun: function(e) {
						console.log(e);
						loadData(e.current);
					}
				});
				loadData(1);
			}
		},
		error:function(xhr,error,status){
			console.log(error);
		}
	})
}


 function loadData(pageid){
	 mylayer.showLoading("商品加载中");
	 $.ajax({
		 type:"GET",
		 url:"../getLunBo",
		 data:{
			 start:(pageid-1)*length,
			 length:length,
		 },
		 dataType:"json",
		 success:function(data){
				mylayer.closeLoading();
			    if(data.retcode==="0"){
			    	var content = $("#content");
			    	content.empty();  //清空所有的内容部分
			    	var thead = $("<tr>\
	    			    	        <th>轮播id</th>\
	    			    	        <th>商品描述</th>\
									<th>图片</th>\
									<th>轮播状态</th>\
									<th>商品操作</th>\
								</tr>");
			    	content.append(thead);
					for(var i=0;i<data.data.length;i++){
						var tr = $("<tr>");
						var lb_id_td = $("<td>"+data.data[i].lb_id+"</td>"); 
						tr.append(lb_id_td);
						
						var lb_id_desc = $("<td style='width:200px;'>"+data.data[i].lb_desc+"</td>"); 
						tr.append(lb_id_desc);
						
						var lb_image_td = $("<td><img style='width:100px;height:100px;' src='../images/roll/"+data.data[i].lb_image+"'/></td>");
						tr.append(lb_image_td);
						
						var lb_state_td = $("<td style='width:200px' class='"+ (data.data[i].lb_state=="0"?"fontred":"fontgreen") +"'>" + (data.data[i].lb_state=="0"?"禁用":"启用") + "</td>")
						tr.append(lb_state_td);
						
						var toggleBtn = $("<button class='layui-btn layui-btn-xs " + (data.data[i].lb_state=="0"?"":"layui-btn-danger") + "' onclick='toggle(this,"+data.data[i].lb_id +")'>" + (data.data[i].lb_state=="0"?"启用":"禁用") + "</button>");
						var deleteBtn = $("<button class='layui-btn layui-btn-xs layui-btn-danger' onclick='deleteLunBo("+ data.data[i].lb_id +")'>删除</button>")
						
						var operate_td = $("<td>");
						operate_td.append(toggleBtn);
						operate_td.append(deleteBtn);
						tr.append(operate_td);
						
						content.append(tr);
					}
					//加载数据后滚动条置顶
					scroll(0,0)
			    }else{	
			    	mylayer.tips(data.data);
			    }
		 },
		 error:function(xhr,status,error){
			 mylayer.tips(data.data);
		 }
	 })
 }

 function toggle(e,lb_id){
	 var newstate;
	 console.log($(e).text())
	 if($(e).text()==="启用"){
		 newstate = 1;
	 }else{
		 newstate = 0;
	 }
	 console.log(newstate);
	 console.log(lb_id);
	 $.ajax({
		 type:"GET",
		 url:"../changeLunBoState",
		 data:{
			 lb_id:lb_id,
			 newstate:newstate
		 },
		 dataType:"json",
		 success:function(data){
			 if(data.retcode === "0"){
				 console.log("change成功");
				 if(newstate==0){
					 console.log(5);
					 $(e).text("启用");
					 $(e).removeClass("layui-btn-danger");
					 $(e).parent().prev().text("禁用");
					 $(e).parent().prev().removeClass("fontgreen");
					 $(e).parent().prev().addClass("fontred");
				 }else{
					 $(e).text("禁用");
					 $(e).addClass("layui-btn-danger");
					 $(e).parent().prev().text("启用");
					 $(e).parent().prev().removeClass("fontred");
					 $(e).parent().prev().addClass("fontgreen");
				 }
			 }else{
				 mylayer.showMessage(data.data);
			 }
		 },
		 error:function(xhr,status,error){
			 console.log(error);
		 }
	 })
 }
 
 function deleteLunBo(lb_id){
	 var flag = window.confirm("确认删除吗？");
	 if(flag){
		 $.ajax({
			 type:"GET",
			 url:"../deleteLunBoById",
			 data:"lb_id=" + lb_id,
			 dataType:"json",
			 success:function(data){
				 if(data.retcode === "0"){
					 mylayer.tips("删除成功");
					 window.location.href = "lunbolist.html";
				 }else{
					 mylayer.tips(data.data);
				 }
			 },
			 error:function(xhr,status,error){
				 console.log(error);
			 }
		 })
	 }
 }
 
 
</script>
</body>
</html>
